<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  .box {
    background: #fff;
    padding: 15px;
    max-width: 400px;
    margin: auto;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  input, button {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
  }
  ul {
    list-style: none;
    padding: 0;
  }
  li {
    background: #eee;
    margin: 5px 0;
    padding: 8px;
    display: flex;
    justify-content: space-between;
  }
  button {
    cursor: pointer;
  }
</style>
</head>
<body>

<div class="box">
  <h2>Login / Signup</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Login</button>
  <button onclick="logout()">Logout</button>
</div>

<br>

<div class="box">
  <h2>Add Expense</h2>
  <input id="amount" type="number" placeholder="Amount">
  <input id="category" placeholder="Category">
  <input id="date" type="date">
  <input id="note" placeholder="Note">
  <button onclick="addExpense()">Add Expense</button>
</div>

<br>

<div class="box">
  <h2>Your Expenses</h2>
  <ul id="expenseList"></ul>
</div>

<script type="module">
  // üîπ Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  // üîπ Firebase config (replace with yours if needed)
  const firebaseConfig = {
    apiKey: "AIzaSyBepaIsV6bFdwFptQAPANVW7YV9jIe2IZU",
    authDomain: "expense-tracker-app-99db5.firebaseapp.com",
    projectId: "expense-tracker-app-99db5",
    storageBucket: "expense-tracker-app-99db5.appspot.com",
    messagingSenderId: "554693088534",
    appId: "1:554693088534:web:81ab35f77aee0f953b2c37"
  };

  // üîπ Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // üîπ Signup function
  window.signup = async () => {
    try {
      await createUserWithEmailAndPassword(auth, email.value, password.value);
      alert("Signed up!");
    } catch (err) {
      alert(err.message);
    }
  };

  // üîπ Login function
  window.login = async () => {
    try {
      await signInWithEmailAndPassword(auth, email.value, password.value);
      alert("Logged in!");
    } catch (err) {
      alert(err.message);
    }
  };

  // üîπ Logout function
  window.logout = async () => {
    await signOut(auth);
    expenseList.innerHTML = "";
  };

  // üîπ Add expense
  window.addExpense = async () => {
    const user = auth.currentUser;
    if (!user) return alert("Login first");
    try {
      await addDoc(collection(db, "users", user.uid, "expenses"), {
        amount: Number(amount.value),
        category: category.value,
        date: date.value,
        note: note.value,
        createdAt: new Date()
      });
      loadExpenses();
    } catch (err) {
      alert(err.message);
    }
  };

  // üîπ Load expenses
  async function loadExpenses() {
    const user = auth.currentUser;
    if (!user) return;

    const snap = await getDocs(collection(db, "users", user.uid, "expenses"));
    expenseList.innerHTML = "";

    snap.forEach(d => {
      const e = d.data();
      expenseList.innerHTML += `
        <li>
          ‚Çπ${e.amount} - ${e.category} - ${e.date}
          <button onclick="deleteExpense('${d.id}')">‚ùå</button>
        </li>
      `;
    });
  }

  // üîπ Delete expense
  window.deleteExpense = async (id) => {
    const user = auth.currentUser;
    if (!user) return;
    await deleteDoc(doc(db, "users", user.uid, "expenses", id));
    loadExpenses();
  };

  // üîπ Persist login
  onAuthStateChanged(auth, user => {
    if (user) loadExpenses();
  });

</script>

</body>
</html>
