<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Tracker - App</title>
<style>
  body { font-family: Arial; background: #f4f4f4; padding: 20px; }
  .box { background: #fff; padding: 15px; max-width: 500px; margin: auto; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
  input, button { width: 100%; padding: 8px; margin: 5px 0; }
  ul { list-style: none; padding: 0; }
  li { background: #eee; margin: 5px 0; padding: 8px; display: flex; justify-content: space-between; }
  button { cursor: pointer; }
</style>
</head>
<body>

<div class="box">
  <h2>Welcome</h2>
  <button onclick="logout()">Logout</button>
</div>

<div class="box">
  <h2>Add Expense</h2>
  <input id="amount" type="number" placeholder="Amount">
  <input id="category" placeholder="Category">
  <input id="date" type="date">
  <input id="note" placeholder="Note">
  <button onclick="addExpense()">Add Expense</button>
</div>

<div class="box">
  <h2>Your Expenses</h2>
  <ul id="expenseList"></ul>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBepaIsV6bFdwFptQAPANVW7YV9jIe2IZU",
    authDomain: "expense-tracker-app-99db5.firebaseapp.com",
    projectId: "expense-tracker-app-99db5",
    storageBucket: "expense-tracker-app-99db5.appspot.com",
    messagingSenderId: "554693088534",
    appId: "1:554693088534:web:81ab35f77aee0f953b2c37"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Protect page: redirect to login if not logged in
  onAuthStateChanged(auth, user => {
    if (!user) window.location = "login.html";
    else loadExpenses();
  });

  // Logout
  window.logout = async () => {
    await signOut(auth);
    window.location = "login.html";
  };

  // Add Expense
  window.addExpense = async () => {
    const user = auth.currentUser;
    if (!user) return alert("Login first");
    await addDoc(collection(db, "users", user.uid, "expenses"), {
      amount: Number(amount.value),
      category: category.value,
      date: date.value,
      note: note.value,
      createdAt: new Date()
    });
    loadExpenses();
  };

  // Load Expenses
  async function loadExpenses() {
    const user = auth.currentUser;
    if (!user) return;
    const snap = await getDocs(collection(db, "users", user.uid, "expenses"));
    expenseList.innerHTML = "";
    snap.forEach(d => {
      const e = d.data();
      expenseList.innerHTML += `
        <li>
          ₹${e.amount} - ${e.category} - ${e.date}
          <button onclick="deleteExpense('${d.id}')">❌</button>
        </li>
      `;
    });
  }

  // Delete expense
  window.deleteExpense = async (id) => {
    const user = auth.currentUser;
    if (!user) return;
    await deleteDoc(doc(db, "users", user.uid, "expenses", id));
    loadExpenses();
  };
</script>

</body>
</html>
